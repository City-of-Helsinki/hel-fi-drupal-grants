diff --git a/src/Plugin/Purge/Purger/VarnishPurgerBase.php b/src/Plugin/Purge/Purger/VarnishPurgerBase.php
index e304309..aef71d0 100644
--- a/src/Plugin/Purge/Purger/VarnishPurgerBase.php
+++ b/src/Plugin/Purge/Purger/VarnishPurgerBase.php
@@ -3,6 +3,7 @@
 namespace Drupal\varnish_purger\Plugin\Purge\Purger;

 use Drupal\Core\Utility\Token;
+use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Drupal\purge\Plugin\Purge\Purger\PurgerBase;
 use Drupal\purge\Plugin\Purge\Purger\PurgerInterface;
 use Drupal\varnish_purger\Entity\VarnishPurgerSettings;
@@ -24,9 +25,16 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
   /**
    * The settings entity holding all configuration.
    *
-   * @var \Drupal\varnish_purger\Entity\VarnishPurgerSettings
+   * @var \Drupal\varnish_purger\Entity\VarnishPurgerSettings|null
    */
-  protected $settings;
+  protected ?VarnishPurgerSettings $settings = NULL;
+
+  /**
+   * The entity type manager.
+   *
+   * @var \Drupal\Core\Entity\EntityTypeManagerInterface
+   */
+  protected EntityTypeManagerInterface $entityTypeManager;

   /**
    * The token service.
@@ -48,12 +56,18 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    *   An HTTP client that can perform remote requests.
    * @param \Drupal\Core\Utility\Token $token
    *   The token service.
+   * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
+   *   The entity type manager.
    */
-  public function __construct(array $configuration, $plugin_id, $plugin_definition, ClientInterface $http_client, Token $token) {
+  public function __construct(array $configuration, $plugin_id, $plugin_definition, ClientInterface $http_client, Token $token, EntityTypeManagerInterface $entity_type_manager) {
     parent::__construct($configuration, $plugin_id, $plugin_definition);
-    $this->settings = VarnishPurgerSettings::load($this->getId());
     $this->client = $http_client;
     $this->token = $token;
+    $this->entityTypeManager = $entity_type_manager;
+
+    // During the first cache rebuild after install, entity type definitions
+    // may be mid-rebuild and class-to-entity resolution can fail in Drupal 11.
+    $this->settings = NULL;
   }

   /**
@@ -65,7 +79,8 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
       $plugin_id,
       $plugin_definition,
       $container->get('http_client'),
-      $container->get('token')
+      $container->get('token'),
+      $container->get('entity_type.manager')
     );
   }

@@ -76,18 +91,44 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
     VarnishPurgerSettings::load($this->getId())->delete();
   }

+  /**
+   * Gets the settings entity for this purger.
+   *
+   * @return \Drupal\varnish_purger\Entity\VarnishPurgerSettings
+   *   The settings entity.
+   *
+   * @throws \Drupal\Component\Plugin\Exception\InvalidPluginDefinitionException
+   * @throws \Drupal\Component\Plugin\Exception\PluginNotFoundException
+   */
+  protected function getSettings(): VarnishPurgerSettings {
+    if ($this->settings instanceof VarnishPurgerSettings) {
+      return $this->settings;
+    }
+
+    $storage = $this->entityTypeManager->getStorage('varnishpurgersettings');
+    $settings = $storage->load($this->getId());
+
+    if (!$settings) {
+      $settings = $storage->create(['id' => $this->getId()]);
+    }
+
+    $this->settings = $settings;
+
+    return $this->settings;
+  }
+
   /**
    * {@inheritdoc}
    */
   public function getCooldownTime() {
-    return $this->settings->cooldown_time;
+    return $this->getSettings()->cooldown_time;
   }

   /**
    * {@inheritdoc}
    */
   public function getIdealConditionsLimit() {
-    return $this->settings->max_requests;
+    return $this->getSettings()->max_requests;
   }

   /**
@@ -102,7 +143,7 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
   protected function getHeaders(array $token_data) {
     $headers = [];
     $headers['user-agent'] = 'varnish_purger module for Drupal 8.';
-    foreach ($this->settings->headers as $header) {
+    foreach ($this->getSettings()->headers as $header) {
       // According to https://tools.ietf.org/html/rfc2616#section-4.2, header
       // names are case-insensitive. Therefore, to aid easy overrides by end
       // users, we lower all header names so that no doubles are sent.
@@ -118,8 +159,8 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    * {@inheritdoc}
    */
   public function getLabel() {
-    if ($this->settings->name) {
-      return $this->settings->name;
+    if ($this->getSettings()->name) {
+      return $this->getSettings()->name;
     }
     else {
       return parent::getLabel();
@@ -136,14 +177,15 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    *   Associative array with option/value pairs.
    */
   protected function getOptions(array $token_data) {
+    $settings = $this->getSettings();
     $opt = [
-      'http_errors' => $this->settings->http_errors,
-      'connect_timeout' => $this->settings->connect_timeout,
-      'timeout' => $this->settings->timeout,
+      'http_errors' => $settings->http_errors,
+      'connect_timeout' => $settings->connect_timeout,
+      'timeout' => $settings->timeout,
       'headers' => $this->getHeaders($token_data),
     ];
-    if ($this->settings->scheme === 'https') {
-      $opt['verify'] = (bool) $this->settings->verify;
+    if ($settings->scheme === 'https') {
+      $opt['verify'] = $settings->verify;
     }
     return $opt;
   }
@@ -152,22 +194,23 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    * {@inheritdoc}
    */
   public function getTimeHint() {
+    $settings = $this->getSettings();

     // When runtime measurement is enabled, we just use the base implementation.
-    if ($this->settings->runtime_measurement) {
+    if ($settings->runtime_measurement) {
       return parent::getTimeHint();
     }

     // Theoretically connection timeouts and general timeouts can add up, so
     // we add up our assumption of the worst possible time it takes as well.
-    return $this->settings->connect_timeout + $this->settings->timeout;
+    return $settings->connect_timeout + $settings->timeout;
   }

   /**
    * {@inheritdoc}
    */
   public function getTypes() {
-    return [$this->settings->invalidationtype];
+    return [$this->getSettings()->invalidationtype];
   }

   /**
@@ -180,12 +223,13 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    *   URL string representation.
    */
   protected function getUri(array $token_data) {
+    $settings = $this->getSettings();
     return sprintf(
       '%s://%s:%s%s',
-      $this->settings->scheme,
-      $this->settings->hostname,
-      $this->settings->port,
-      $this->token->replace($this->settings->path, $token_data)
+      $settings->scheme,
+      $settings->hostname,
+      $settings->port,
+      $this->token->replace($settings->path, $token_data)
     );
   }

@@ -193,7 +237,7 @@ abstract class VarnishPurgerBase extends PurgerBase implements PurgerInterface {
    * {@inheritdoc}
    */
   public function hasRuntimeMeasurement() {
-    return (bool) $this->settings->runtime_measurement;
+    return $this->getSettings()->runtime_measurement;
   }

 }
